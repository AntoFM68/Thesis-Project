<mujoco model="deepracer">

    <compiler angle="radian" inertiafromgeom="true" meshdir="Meshes"/>
    <option gravity="0 0 -9.81" timestep="0.002" />

    <default>
        <default class="wheel">
            <geom type="cylinder" size="0.035 0.02" quat="0.707107 0.707107 0 0" mass="0.042222" contype="1" conaffinity="0" friction="2 0.005 0.0001" />
        </default>
        <default class="z_joint">
            <joint type="hinge" axis="0 0 1" damping="0.01" armature="0.0002" frictionloss="0.01" limited="true" range="-0.523599 0.523599" />
        </default>
        <default class="y_joint">
            <joint type="hinge" axis="0 1 0" damping="0.01" armature="0.01" frictionloss="0.001" />
        </default>
        <geom rgba="0.2 0.2 0.2 1"/>
        <site size="0.002 0.005" type="capsule" rgba="1 0 0 1" />
    </default>
    
    <worldbody>

        <body name="aws_deepracer">
            <joint type="free" />
            <site name="sensor" pos="0 0 0.1" />
            <camera name="DR_fixed" mode="trackcom" pos="-1.5 0 1.25" xyaxes="0 -1 0 0.707 0 0.707" />
            <camera name="DR_orient" mode="targetbodycom" target="chassis" pos="-1 0 0.6" xyaxes="0 -1 0 0.707 0 0.707" />

            <!-- <geom pos="0.02913 0 0.18645" quat="-3.67321e-06 0 0 1" type="mesh" mesh="laser" contype="2" conaffinity="2" group="1" /> -->
            <!-- <geom pos="-0.0762 0 0.02502" rgba="0.2 0.2 1 1" type="mesh" mesh="deepracer" contype="2" conaffinity="2" group="2" /> -->

            <body name="chassis" pos="0 0 0.025">
                <geom type="mesh" mesh="chassis" mass="1.9068" rgba="0.4 0.4 0.4 1" contype="2" conaffinity="2" />

                <body name="steering_wheel" pos="0.082311 0 0.011759">
                    <geom type="mesh" mesh="steer" quat="0 1 0 0" mass="0.005" contype="0" conaffinity="0" />
                    <joint name="steering_wheel" class="z_joint" />
                </body>
                <body name="right_front_wheel" pos="0.082311 -0.079601 0.011759">
                    <geom class="wheel" />
                    <joint name="RF_steering_joint" class="z_joint" />
                    <joint name="RFw_joint" class="y_joint" />

                    <site pos="0.024 0.019 0" />
                    <site pos="0.024 -0.019 0" />
                    <site pos="-0.024 0.019 0" />
                    <site pos="-0.024 -0.019 0" />
                </body>
                <body name="left_front_wheel" pos="0.082311 0.079601 0.011759">
                    <geom class="wheel" />
                    <joint name="LF_steering_joint" class="z_joint" />
                    <joint name="LFw_joint" class="y_joint" />

                    <site pos="0.024 0.019 0" />
                    <site pos="0.024 -0.019 0" />
                    <site pos="-0.024 0.019 0" />
                    <site pos="-0.024 -0.019 0" />
                </body>

                <body name="right_back_wheel" pos="-0.081663 -0.08105 0.01575">
                    <geom class="wheel" />
                    <joint name="RBw_joint" class="y_joint" />

                    <site pos="0.024 0.019 0" />
                    <site pos="0.024 -0.019 0" />
                    <site pos="-0.024 0.019 0" />
                    <site pos="-0.024 -0.019 0" />
                </body>
                <body name="left_back_wheel" pos="-0.081663 0.08105 0.01575">
                    <geom class="wheel" />
                    <joint name="LBw_joint" class="y_joint" />

                    <site pos="0.024 0.019 0" />
                    <site pos="0.024 -0.019 0" />
                    <site pos="-0.024 0.019 0" />
                    <site pos="-0.024 -0.019 0" />
                </body>
                <body name="cameras" pos="0.094211 -0.03 0.079989" quat="0.9914445 -0.0001039 0.1305265 0.0007895">
                    <geom  mass="0.002" type="mesh" mesh="r_camera" rgba="1 1 1 1" contype="2" conaffinity="2" group="1" />
                    <geom pos="0 0.06 0" mass="0.002" type="mesh" mesh="l_camera" rgba="1 1 1 1" contype="2" conaffinity="2" group="1" />
                    <camera name="R_camera" mode="fixed" fovy="120" pos="0.045 0 0.037" quat="-0.5 -0.4999518 0.5 0.5000482" />
                    <camera name="L_camera" mode="fixed" fovy="120" pos="0.045 0.06 0.037" quat="-0.5 -0.4999518 0.5 0.5000482" />
                </body>
            </body>
        </body>
    </worldbody>

    <asset>
        <!-- <mesh name="laser" file="laser.STL" /> -->
        <!-- <mesh name="deepracer" file="deepracer_with_lidar.STL" /> -->
        <mesh name="chassis" file="simplify_chassis40.STL" />
        <mesh name="steer" file="steering_hinge.STL" />
        <mesh name="r_camera" file="zed_camera_link_rightcam.STL" />
        <mesh name="l_camera" file="zed_camera_link_leftcam.STL" />
    </asset>

    <actuator>
        <motor joint="RBw_joint" name="throttle_motor" ctrllimited="true" ctrlrange="-1 1" gear="1.5" />
        <position joint="steering_wheel" name="steering_motor" ctrllimited="true" ctrlrange="-0.523599 0.523599" kp="1" />
    </actuator>

    <equality>
        <!-- L=0.163974: distanza assi, l=0.159202: distanza ruote anteriori; delta=-pi/2-arctg(L/(L/tan(delta)+-l/2)) -->
        <joint joint1="LF_steering_joint" joint2="steering_wheel" polycoef="0 0.9708978253 -0.00051 0.1896603979 0.900623517"/>
        <joint joint1="RF_steering_joint" joint2="steering_wheel" polycoef="0 0.9708978253 0.00051 0.1896603979 -0.900623517"/>
        <!-- same actuation for both rear wheels -->
        <joint joint1="RBw_joint" joint2="LBw_joint" polycoef="0 1 0 0 0" />
        <joint joint1="RBw_joint" joint2="LFw_joint" polycoef="0 1 0 0 0" />
        <joint joint1="RBw_joint" joint2="RFw_joint" polycoef="0 1 0 0 0" />
    </equality>

    <sensor>
        <!-- <accelerometer name="deepracer_acc" site="sensor" /> -->
        <gyro name="deepracer_gyro" site="sensor" />
        <velocimeter name="deepracer_vel" site="sensor" />
    </sensor>

</mujoco>